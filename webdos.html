<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DOSBox in Browser (ZIP + ISO Mount)</title>
  <script src="https://js-dos.com/v8/current/js-dos-api.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      height: 100%;
      font-family: monospace;
      display: flex;
      flex-direction: column;
    }
    #controls {
      background: #222;
      padding: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      z-index: 2;
    }
    #controls input, #controls button {
      padding: 5px;
    }
    #dos {
      flex-grow: 1;
    }
  </style>
</head>
<body>
  <div id="controls">
    <input type="file" id="fileInput" accept=".zip,.iso,.img" />
    <button id="startBtn">Start DOSBox</button>
  </div>
  <div id="dos"></div>

  <script>
    const { emulators } = Dos();
    const fileInput = document.getElementById("fileInput");
    const startBtn = document.getElementById("startBtn");

    startBtn.addEventListener("click", async () => {
      const file = fileInput.files[0];
      if (!file) return alert("Choose a ZIP or ISO file first.");

      const emulator = await emulators.dosbox({
        id: "dos",
        autoResize: true,
        onExit: () => console.log("Emulator exited"),
        onError: (e) => console.error("Emulator error:", e),
      });

      emulator.events.on("ready", async () => {
        const lower = file.name.toLowerCase();

        if (lower.endsWith(".zip")) {
          await emulator.fs.extract(file);
          emulator.sendCommand("mount c .");
          emulator.sendCommand("c:");
          emulator.sendCommand("dir");
          emulator.sendCommand("echo ZIP extracted to C:");
        } else if (lower.endsWith(".iso") || lower.endsWith(".img")) {
          await emulator.fs.createFile(file.name, file);
          emulator.sendCommand(`imgmount d ${file.name} -t iso`);
          emulator.sendCommand("d:");
          emulator.sendCommand("dir");
          emulator.sendCommand("echo ISO mounted to D:");
        } else {
          emulator.sendCommand("echo Unsupported file type.");
        }
      });

      emulator.start();
    });
  </script>
</body>
</html>
