<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DOSBox-X with ISO/ZIP Mount</title>
  <script src="https://js-dos.com/v8/current/js-dos-api.js"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      color: white;
      font-family: monospace;
      display: flex;
      flex-direction: column;
    }
    #controls {
      background: #222;
      padding: 10px;
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
    }
    input[type="file"] {
      background: #333;
      color: white;
      padding: 5px;
      border: 1px solid #555;
    }
    button {
      background: #28a745;
      color: white;
      border: none;
      padding: 6px 12px;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background: #218838;
    }
    #dos {
      flex-grow: 1;
    }
  </style>
</head>
<body>
  <div id="controls">
    <input type="file" id="fileInput" accept=".iso,.img,.zip,.cue,.bin" />
    <button id="startBtn">Start DOSBox-X</button>
  </div>
  <div id="dos"></div>

  <script>
    const { emulators } = Dos();
    const fileInput = document.getElementById("fileInput");
    const startBtn = document.getElementById("startBtn");

    startBtn.addEventListener("click", async () => {
      const file = fileInput.files[0];
      if (!file) {
        alert("Please choose an ISO or ZIP file.");
        return;
      }

      const emulator = await emulators.dosboxXWorker({
        id: "dos",
        autoResize: true,
        onError: (err) => console.error("DOSBox-X error:", err),
      });

      emulator.events.on("ready", async () => {
        const filename = file.name.toLowerCase();

        if (filename.endsWith(".zip")) {
          await emulator.fs.extract(file);
          emulator.sendCommand("mount c .");
          emulator.sendCommand("c:");
          emulator.sendCommand("dir");
          emulator.sendCommand("echo ZIP extracted to C:");
        }
        else if (filename.endsWith(".iso") || filename.endsWith(".img")) {
          await emulator.fs.createFile(file.name, file);
          emulator.sendCommand(`imgmount d ${file.name} -t iso`);
          emulator.sendCommand("d:");
          emulator.sendCommand("dir");
          emulator.sendCommand(`echo ISO mounted as D:`);
        }
        else {
          emulator.sendCommand("echo Unsupported file type.");
        }

        emulator.sendCommand("echo You are now in real DOS shell.");
      });

      emulator.start();
    });
  </script>
</body>
</html>
